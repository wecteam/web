---
title: 编写前端配置文件的正确姿势
subtitle: "我辛辛苦苦看完了各个文档，写的时候却发现压根记不住那些配置字段，我的内心是崩溃的，说好的开发体验呢，有个锤子体验呀"
date: 2019-07-12 21:04:08
cover: https://img11.360buyimg.com/jdphoto/s1500x706_jfs/t1/70908/7/5181/760941/5d36b5e5E6a52b971/5a47fcbd14fc398e.jpg
tags: 前端工程化
categories: 前端工程化
ckey: 20
author:
    nick: 谢志强
    github_name: xiezhiqiang9
---


现在前端有非常多的工具（webpack、rollup、eslint、prettier、husky、lerna、commitlint等等），这些工具都是为了优化提高前端的开发体验而诞生的。但是问题来了，这些工具有非常多的配置字段，基本靠记忆是搞不定的，所以很多情况都是前人写好，后人拷贝。但是本着不想成为成为拷贝工程师的原则，我辛辛苦苦看完了各个文档，写的时候却发现压根记不住那些配置字段，我的内心是崩溃的，说好的开发体验呢，有个锤子体验呀。。。

![](https://camo.githubusercontent.com/f727f798c2dbb25859f4907cbf3dc684c7fe87bb/687474703a2f2f7777322e73696e61696d672e636e2f626d6964646c652f39313530653465356c7931667071756a72317233386a32303573303464676c6b2e6a7067)

编写配置文件应该是能够智能提示字段，并且当我字段写错的时候是能够标红的，就像编写 ts 一样

![](https://camo.githubusercontent.com/49029719e0db84fc6b003b35fc4b77683fa94298/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031392f372f31312f313662653131316131623663656130323f773d3133313226683d37353026663d67696626733d363737323036)

很多前端工具都支持rc文件、`.json`、`.yaml`、`.yml`、`.js` 文件中编写配置项目，因为其实基本上都是使用了 [cosmiconfig](https://github.com/davidtheclark/cosmiconfig) 这个库（或者有类似功能的库）。

如果配置文件是 `.ts` 文件的话是能够通过编写声明文件来约束和智能提示的，但是如果说配置文件还需要通过 tsc 来编译过去，这样就有点傻了。

**所幸的其实我们可以通过 jsdoc 注释来实现对 js 的类型约束。**

首先配置下 vscode 的设置，打开 setting，设置 `javascript.implicitProjectConfig.checkJs` 为true，可以通过可视化栏目，搜索 `checkjs`，勾选对应的选项：
![](https://camo.githubusercontent.com/e42ee15396d820fcd19124ed4dfd2ae3fa5de29e/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031392f372f31312f313662653131653337383636363466663f773d3230353826683d35363026663d706e6726733d313130313535)

或者直接在 `settings.json` 文件中写入：

```js
"javascript.implicitProjectConfig.checkJs": true
```

要约束对应的类型，使用 jsdoc 的 `@type` 即可，如：

![](https://camo.githubusercontent.com/9012e4f77655fa015a1f607875d99bdddc94afcb/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031392f372f31312f313662653132376563643636356264313f773d3135333126683d36323926663d706e6726733d313033393733)


约束变量name为数字，赋值字符串就标红提醒了。

那么现在的关键就是需要有对应工具配置项的 interface，这样就能约束和智能提示了。

以 `webpack` 为例，`webpack` 声明文件导出了一个名为 `Configuration` 的 interface，使用这个可以约束和智能提示 `webpack` 的配置：
![](https://camo.githubusercontent.com/c89a948229a45b1073203edfbd34bba18fe372a3/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031392f372f31312f313662653132646663633039366562663f773d3133383226683d38323626663d67696626733d31363037353238)

同理，我也找到了 `rollup` 的是 `RollupOptions`：

![](https://camo.githubusercontent.com/9974ebbd3e2ca2dc1f9bd9365e53a2be94d06422/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031392f372f31312f313662653133323339383039666564393f773d3133383226683d38323626663d67696626733d31303339363830)

按照这个思路，如果说这些工具有相应的声明文件并且声明文件里定义了配置项的类型，并且这个工具可以支持以 `.js` 文件配置，那么就可以按照上面的思路来约束和提示。

但是很不幸的是，有些工具不支持以 `.js` 文件配置，比如 `lerna` ，同样还有很多工具并没有相应的声明文件，比如 `lerna`、`husky`、`commitlint` 。


当然自己编写声明文件这个思路是可以的，但是 lerna 这类只支持 `.json` 文件配置怎么解决？

很明显这需要一个 json 数据校验器，很棒的是开源社区的巨巨们其实已经为我等菜鸡编写好了大部分的校验器。

![](https://camo.githubusercontent.com/c93e8cfe3ffc9e5d2049e0fa0d41ad87a0125e1b/687474703a2f2f7777332e73696e61696d672e636e2f626d6964646c652f39313530653465356c7931666e3064373365376d7467323038633038633734642e676966)


巨巨们发起的项目叫 [schemastore](https://github.com/schemastore/schemastore/) ，网站是 [http://schemastore.org/json/](http://schemastore.org/json/) ，打开网站便是映入眼帘的满满的各类 json schema：

![](https://camo.githubusercontent.com/ac7db3f4f932d881d63851cab7162898fda6534a/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031392f372f31312f313662653134396263396436313639663f773d3139353426683d3135383426663d706e6726733d343131393131)

接下来的问题就是通过设置 vscode 来对特定 json 文件进行约束和智能提示。

直接在 vscode 的 `settings.json` 文件中编写，如约束lerna 的：

```js
"json.schemas": [{
       "fileMatch": [
            "lerna.json"
        ],
        "url": "http://json.schemastore.org/lerna.json"
    }
]
```

![](https://camo.githubusercontent.com/bf892443fe117dbfeed2fb554b08e2781ac92a5c/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031392f372f31312f313662653135333833383136613263393f773d3133383226683d38323626663d67696626733d31313931303636)


棒棒棒，这才是可以接受的开发体验呀。

![](https://camo.githubusercontent.com/de83899a4feab43b223195beb5f8313224b3b38b/687474703a2f2f7777332e73696e61696d672e636e2f626d6964646c652f39313530653465356a7731666362717163716539396732303863303863676e752e676966)


我挑选了常用的 `babel`、`lerna`、`husky`、`eslint`、`prettier`、`travis` 等，配置如下：

```js
{
    "json.schemas": [{
        "fileMatch": [
            "/.babelrc"
        ],
        "url": "http://json.schemastore.org/babelrc"
    }, {
        "fileMatch": [
            "lerna.json"
        ],
        "url": "http://json.schemastore.org/lerna.json"
    }, {
        "fileMatch": [
            "/.huskyrc"
        ],
        "url": "http://json.schemastore.org/huskyrc"
    }, {
        "fileMatch": [
            "/.csslintrc"
        ],
        "url": "http://json.schemastore.org/csslintrc"
    }, {
        "fileMatch": [
            ".eslintrc"
        ],
        "url": "http://json.schemastore.org/eslintrc"
    }, {
        "fileMatch": [
            ".htmlhintrc"
        ],
        "url": "http://json.schemastore.org/htmlhint"
    }, {
        "fileMatch": [
            "jsconfig.json"
        ],
        "url": "http://json.schemastore.org/jsconfig"
    }, {
        "fileMatch": [
            ".prettierrc"
        ],
        "url": "http://json.schemastore.org/prettierrc"
    }, {
        "fileMatch": [
            ".travis.yml"
        ],
        "url": "http://json.schemastore.org/travis"
    }, {
        "fileMatch": [
            ".lintstagedrc"
        ],
        "url": "http://json.schemastore.org/lintstagedrc.schema"
    }]
}
```

当然以上情况不可能满足所有的情况，有很多小众但是非常优秀的轮子和工具，但是以上就是思路和意识，当碰到类似情况的时候，就可以自己动手编写声明文件和 jsonschema 来解决了。


![](https://camo.githubusercontent.com/e67fc46791c8566374df2fffe44cc8ba95074f9d/687474703a2f2f7777342e73696e61696d672e636e2f626d6964646c652f30303641506f46596a7731666336626b66387076736a3330623430623464676c2e6a7067)



手动贴下个人博客的地址 [https://github.com/huruji/blog](https://github.com/huruji/blog)
